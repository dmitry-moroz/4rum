{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}
{% import "_macros.html" as macros %}

{% block title %}4RUM - {{ topic.title }}{% endblock %}

{% block page_content %}
<div class="page-header">
    <img class="common-thumbnail" src="{{ url_for('static', filename='speech-icon.png') }}">
    <div class="topic-page-header">
        <h2>{{ topic.title }}</h2>
    </div>
</div>
{% include '_buttons_topic.html' %}

<div class="topic-page img-rounded">

    <div class="topic-page-title">

        <div>
            <a href="{{ url_for('main.user', username=topic.author.username) }}">
                <img class="img-rounded common-thumbnail" src="{{ topic.author.avatar }}">
            </a>
        </div>

        <div class="topic-page-meta">
            <div class="topic-date">Created: {{ moment(topic.created_at).format('D MMMM YYYY, H:mm') }}</div>
            <div class="topic-author"><a href="{{ url_for('main.user', username=topic.author.username) }}">{{ topic.author.username }}</a></div>
            {% if topic.author.name %}
            <div class="topic-author">{{ topic.author.name }}</div>
            {% else %}
            <br>
            {% endif %}
        </div>

    </div>

    <div class="topic-page-content">
        {% if topic.body_html %}
            {{ topic.body_html | safe }}
        {% else %}
            {{ topic.body }}
        {% endif %}

    {% if topic.poll %}
        <br>
        <h4 id="poll">{{ topic.poll }}</h4>
        {% if poll_results %}
        <ul class="poll_answers_voted">
            {% for answer, votes, percent in poll_results %}
                <li class="poll_answer_voted img-rounded">
                    {{ answer }}
                    <div class="poll_percent_info">
                        {{ percent }}% ({{ votes }} votes)
                    </div>
                    <div class="poll_progress img-rounded">
                        <div class="poll_progress_bar img-rounded" style="width:{{ percent }}%;">&nbsp;</div>
                    </div>
                </li>
            {% endfor %}
        </ul>
        {% else %}
        <ul class="poll_answers">
            {% for answer in topic.poll_answers.filter_by(deleted=False) %}
            <a class="no-underline" href="{{ url_for('main.vote', answer_id=answer.id, next=request.url) }}">
                <li class="poll_answer img-rounded">
                    {{ answer.body }}
                </li>
            </a>
            {% endfor %}
        </ul>
        {% endif %}
    {% endif %}

    </div>

</div>

<div id="comments" class="page-header">
    <img class="common-thumbnail" src="{{ url_for('static', filename='comments-icon.png') }}">
    <div class="topic-page-header">
        <h2>Comments:</h2>
    </div>
</div>

{% if form %}
    <div>
        <a href="{{ url_for('main.user', username=current_user.username) }}">
            <img class="img-rounded common-thumbnail" src="{{ current_user.avatar }}">
        </a>
    </div>
    <div class="comments-form">
        {{ wtf.quick_form(form, button_map={'submit':'success'}) }}
    </div>
{% endif %}

{% include '_comments.html' %}
{% if pagination %}
<div class="pagination">
    {{ macros.pagination_widget(pagination, 'main.topic', topic_id=topic.id, fragment='#comments') }}
</div>
{% endif %}

{% endblock %}